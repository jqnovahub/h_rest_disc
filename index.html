
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H Restaurant - Gift Cards</title>
    <style>
        /* TODO EL CSS SE MANTIENE IGUAL */
        :root {
            --primary-color: #008080;
            --secondary-color: #f5f5f5;
            --accent-color: #388e3c;
            --text-color: #333;
            --light-text: #fff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 25px 0;
            text-align: center;
            border-radius: 10px 10px 0 0;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* AGREGAR RALEWAY */
@import url('https://fonts.googleapis.com/css2?family=Raleway:wght@400;600;700&display=swap');

/* APLICAR RALEWAY A LOS T√çTULOS */
h1 {
    font-family: 'Raleway', sans-serif;
    font-weight: 700;
    font-size: 2.2rem; /* M√°s peque√±o que el original 2.5rem */
    margin-bottom: 10px;
}

.subtitle {
    font-family: 'Raleway', sans-serif;
    font-size: 1.1rem; /* M√°s peque√±o que el original 1.2rem */
    opacity: 0.9;
    font-weight: 400;
}

h2 {
    font-family: 'Raleway', sans-serif;
    color: var(--primary-color);
    margin-bottom: 15px;
    font-size: 1.6rem; /* Ajustado */
    font-weight: 600;
}

h3 {
    font-family: 'Raleway', sans-serif;
    color: var(--text-color);
    margin-bottom: 10px;
    font-size: 1.2rem; /* Ajustado */
    font-weight: 600;
}

/* OPCIONAL: Aplicar Raleway a todo el cuerpo si quieres consistencia */
body {
    font-family: 'Raleway', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        input[type="text"],
        input[type="tel"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        input[type="tel"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(198, 40, 40, 0.1);
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #a01515;
            transform: translateY(-1px);
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-whatsapp {
            background-color: #25D366;
        }
        
        .btn-whatsapp:hover {
            background-color: #1da851;
        }
        
        .btn-secondary {
            background-color: #666;
        }
        
        .btn-secondary:hover {
            background-color: #555;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .success-message {
            background-color: #e8f5e9;
            color: var(--accent-color);
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-color);
        }
        
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid #c62828;
        }
        
        .code-display {
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
            letter-spacing: 3px;
            border: 2px dashed #ddd;
        }
        
        .validity-info {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e3f2fd;
            border-radius: 4px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            background-color: white;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
        }
        
        .tab:hover {
            background-color: #f5f5f5;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .terms {
            font-size: 0.9rem;
            color: #666;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9rem;
            padding: 20px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .team-member {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }
        
        .connection-status {
            padding: 10px;
            text-align: center;
            border-radius: 4px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .status-connected { background-color: #4caf50; color: white; }
        .status-error { background-color: #f44336; color: white; }
        
        .debug-info {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            font-size: 0.8rem;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        h3 {
            color: var(--text-color);
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .terms ul {
            padding-left: 20px;
            margin-top: 10px;
        }
        
        .terms li {
            margin-bottom: 8px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                margin-right: 0;
.logo-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
    max-width: 100%;
    margin-bottom: 10px;
}

.logo {
    height: 60px;           /* Tama√±o fijo de 60px */
    width: auto;            /* Ancho autom√°tico */
    object-fit: contain;    /* Mantiene proporci√≥n */
}

.title-container {
    text-align: center;
    flex-grow: 1;
}

/* Para m√≥viles */
@media (max-width: 768px) {
    .logo-container {
        flex-direction: column;
        gap: 15px;
    }
    .logo {
        height: 50px;       /* Un poco m√°s peque√±o en m√≥viles */
    }
}
    </style>
</head>
<body>
    <div class="container">
        <header>
    <div class="logo-container">
        <img src="https://dl.dropbox.com/scl/fi/04lnq6u4rwczzfsp5nnq1/logo_historias_y_un_cafe_03.png?rlkey=a3emgxnma2tgkp1c8b8yh1ja5&st=b837h8k0&dl=0" alt="Historias y un caf√©" style="height: 80px; width: auto; object-fit: contain;">
        
        <div class="title-container">
            <h1>Historias y un caf√© - H Restaurant</h1>
            <p class="subtitle">Programa de Lealtad de Historias y un caf√©</p>
        </div>
        
        <img src="https://dl.dropbox.com/scl/fi/nlqazwegel0l19hz0pr7x/logo-h_restaurant.png?rlkey=a2djzlq1k372r14bp0tg75zos&st=l07p4eac&dl=0" alt="H Restaurant" 
             style="height: 80px; width: auto; object-fit: contain;">
    </div>
</header>
        
        
        <div class="tabs">
            <div class="tab active" data-tab="register">Registrar Cliente</div>
            <div class="tab" data-tab="redeem">Redimir Descuento</div>
        </div>
        
        <div class="tab-content active" id="register-tab">
            <div class="card">
                <h2>Registrar Nuevo Cliente</h2>
                <p>Complete la informaci√≥n para generar un c√≥digo de descuento del 15%</p>
                
                <form id="register-form">
                    <div class="form-group">
                        <label for="name">Nombre Completo *</label>
                        <input type="text" id="name" name="name" required placeholder="Ingrese el nombre completo">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">N√∫mero de Tel√©fono *</label>
                        <input type="tel" id="phone" name="phone" required placeholder="Ingrese el n√∫mero de tel√©fono">
                    </div>
                    
                    <div class="form-group">
                        <label for="team-member">Miembro del Equipo *</label>
                        <select id="team-member" name="team-member" required>
                            <option value="">Seleccione un miembro del equipo</option>
                            <option value="Aida">Aida</option>
                            <option value="Alanis">Alanis</option>
                            <option value="Jos√©">Jos√©</option>
                            <option value="Kiaraliz">Kiaraliz</option>
                            <option value="Tamara">Tamara</option>
                            <option value="Valeria">Valeria</option>
                            <option value="Ver√≥nica">Ver√≥nica</option>
                        </select>
                    </div>
                    
                    <button type="submit" id="register-btn">
                        <span class="loading hidden"></span>
                        Generar C√≥digo de Descuento
                    </button>
                </form>
                
                <div class="success-message hidden" id="register-success">
                    <h3>¬°Cliente registrado exitosamente!</h3>
                    <p>Se ha generado el siguiente c√≥digo de descuento:</p>
                    <div class="code-display" id="generated-code"></div>
                    
                    <div class="validity-info" id="validity-info"></div>
                    
                    <div class="team-member">
                        <strong>Registrado por:</strong> <span id="registered-by"></span>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" class="btn-whatsapp" id="whatsapp-btn">
                            üì± Enviar por WhatsApp
                        </button>
                        <button type="button" class="btn-secondary" id="new-client-btn">
                            ‚ûï Nuevo Cliente
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="redeem-tab">
            <div class="card">
                <h2>Redimir Descuento</h2>
                <p>Ingrese la informaci√≥n del cliente o el c√≥digo para aplicar el descuento</p>
                
                <form id="redeem-form">
                    <div class="form-group">
                        <label for="redeem-phone">N√∫mero de Tel√©fono</label>
                        <input type="tel" id="redeem-phone" name="redeem-phone" placeholder="Ingrese el tel√©fono del cliente">
                    </div>
    
                    <div class="form-group">
                        <label for="redeem-code">C√≥digo de Descuento</label>
                        <input type="text" id="redeem-code" name="redeem-code" placeholder="Ingrese el c√≥digo de descuento">
                    </div>
    
                    <p class="terms">Nota: Ingrese el n√∫mero de tel√©fono y/o c√≥digo del cliente para buscar el descuento.</p>
    
                    <button type="submit" id="redeem-btn">
                        <span class="loading hidden"></span>
                        Verificar y Aplicar Descuento
                    </button>
                </form>
                
                <div class="success-message hidden" id="redeem-success">
                    <h3>¬°Descuento aplicado exitosamente!</h3>
                    <p>Se ha aplicado un 15% de descuento al consumo (excluyendo bebidas) de <span id="customer-name"></span>.</p>
                    <p>El c√≥digo utilizado fue: <strong id="used-code"></strong></p>
                </div>
                
                <div class="error-message hidden" id="redeem-error">
                    <h3>No se pudo aplicar el descuento</h3>
                    <p id="error-message">El c√≥digo o la informaci√≥n del cliente no son v√°lidos o ya han sido utilizados.</p>
                </div>
            </div>
        </div>
        
        <div class="terms card">
            <h3>T√©rminos y Condiciones</h3>
            <ul>
                <li>El descuento del 15% aplica √∫nicamente al consumo de alimentos, excluyendo bebidas.</li>
                <li>Cada c√≥digo es v√°lido para un solo uso.</li>
                <li>El descuento no es transferible y no puede combinarse con otras promociones.</li>
                <li>El c√≥digo tiene validez de 30 d√≠as a partir de la fecha de emisi√≥n.</li>
                <li>H Restaurant se reserva el derecho de modificar estos t√©rminos en cualquier momento.</li>
            </ul>
        </div>
        
        <footer>
            <p>H Restaurant &copy; 2023 - Sistema de Tarjetas de Regalo</p>
        </footer>
    </div>

    <script>
        // ‚ö†Ô∏è TU URL REAL DE SHEETDB
        const SHEETDB_URL = 'https://sheetdb.io/api/v1/2ctd5w1czlgzf';
        
        let currentCustomerData = null;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Aplicaci√≥n H Restaurant con SheetDB iniciada');
            setupEventListeners();
            testConnection();
        });

        async function testConnection() {
            try {
                document.getElementById('debug-content').textContent = 'Probando conexi√≥n con SheetDB...';
                const response = await fetch(SHEETDB_URL);
                const data = await response.json();
                document.getElementById('debug-content').textContent = `‚úÖ Conexi√≥n exitosa. ${data.length} registros encontrados.`;
                console.log('Test conexi√≥n:', data);
            } catch (error) {
                document.getElementById('debug-content').textContent = `‚ùå Error de conexi√≥n: ${error.message}`;
                console.error('Error test conexi√≥n:', error);
            }
        }

        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegistration();
            });

            document.getElementById('whatsapp-btn').addEventListener('click', sendWhatsAppMessage);
            document.getElementById('new-client-btn').addEventListener('click', resetRegistrationForm);
            document.getElementById('redeem-form').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRedemption();
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            hideAllMessages();
        }

        function hideAllMessages() {
            document.querySelectorAll('.success-message, .error-message').forEach(msg => {
                msg.classList.add('hidden');
            });
        }

        function showLoading(buttonId) {
            const button = document.getElementById(buttonId);
            button.disabled = true;
            const loading = button.querySelector('.loading');
            if (loading) loading.classList.remove('hidden');
        }

        function hideLoading(buttonId) {
            const button = document.getElementById(buttonId);
            button.disabled = false;
            const loading = button.querySelector('.loading');
            if (loading) loading.classList.add('hidden');
        }

        function calculateExpiryDate() {
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + 30);
            return expiryDate.toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function formatWhatsAppMessage(customerData) {
            const expiryDate = calculateExpiryDate();
            return `üéâ ¬°Invitaci√≥n Especial de Historias y un Caf√©!

Como cliente leal, te invitamos a descubrir H Restaurant con un 15% de descuento exclusivo.

H Restaurant es nuestro nuevo concepto de fusi√≥n creativa. Muestra este c√≥digo al momento de pagar.

Tu c√≥digo: ${customerData.code}

üì± *Explora nuestro men√∫ digital:*
https://hrestaurant.glide.page

‚ö†Ô∏è *T√©rminos:*
‚Ä¢ No aplica a bebidas alcoh√≥licas
‚Ä¢ V√°lido por 30 d√≠as (hasta el ${expiryDate})

¬°Esperamos verte pronto en H Restaurant! üçΩÔ∏è‚ú®`;
        }

        async function handleRegistration() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const teamMember = document.getElementById('team-member').value;
            
            if (!name || !phone || !teamMember) {
                alert('Por favor complete todos los campos obligatorios.');
                return;
            }

            showLoading('register-btn');
            hideAllMessages();
            document.getElementById('debug-content').textContent = 'Enviando datos a SheetDB...';

            try {
                const code = generateUniqueCode();
                const response = await registerCustomer(name, phone, teamMember, code);
                document.getElementById('debug-content').textContent = `Respuesta recibida: ${JSON.stringify(response)}`;
                
                // VERIFICACI√ìN MEJORADA - SheetDB puede devolver diferentes estructuras
                if (response && (response.created > 0 || response.id)) {
                    currentCustomerData = { 
                        name, 
                        phone, 
                        code: code, // Usamos el c√≥digo que generamos, no el de la respuesta
                        teamMember, 
                        expiryDate: calculateExpiryDate() 
                    };
                    showRegistrationSuccess(code, teamMember);
                } else {
                    alert('Error al registrar el cliente. Respuesta: ' + JSON.stringify(response));
                }
            } catch (error) {
                console.error('Error completo:', error);
                document.getElementById('debug-content').textContent = `‚ùå Error: ${error.message}`;
                alert('Error de conexi√≥n: ' + error.message);
            } finally {
                hideLoading('register-btn');
            }
        }

        function showRegistrationSuccess(code, teamMember) {
            document.getElementById('generated-code').textContent = code;
            document.getElementById('registered-by').textContent = teamMember;
            document.getElementById('validity-info').textContent = `‚úÖ V√°lido hasta el ${calculateExpiryDate()}`;
            document.getElementById('register-success').classList.remove('hidden');
        }

        function sendWhatsAppMessage() {
            if (!currentCustomerData) {
                alert('No hay datos de cliente para enviar.');
                return;
            }
            
            const message = formatWhatsAppMessage(currentCustomerData);
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${currentCustomerData.phone}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        function resetRegistrationForm() {
            document.getElementById('register-form').reset();
            document.getElementById('register-success').classList.add('hidden');
            currentCustomerData = null;
            document.getElementById('debug-content').textContent = 'Formulario reiniciado. Listo para nuevo registro.';
        }

        async function handleRedemption() {
            // SOLO tel√©fono y c√≥digo - sin nombre
            const phone = document.getElementById('redeem-phone').value.trim();
            const code = document.getElementById('redeem-code').value.trim().toUpperCase();
    
            if (!phone && !code) {
                alert('Por favor ingrese tel√©fono o c√≥digo para buscar.');
                return;
            }

            showLoading('redeem-btn');
            hideAllMessages();
            document.getElementById('debug-content').textContent = `Buscando c√≥digo: ${code}`;

            try {
                const response = await redeemDiscount(name, phone, code);
                
                if (response.success) {
                    document.getElementById('customer-name').textContent = response.customerName;
                    document.getElementById('used-code').textContent = response.code;
                    document.getElementById('redeem-success').classList.remove('hidden');
                    document.getElementById('redeem-form').reset();
                    document.getElementById('debug-content').textContent = '‚úÖ Descuento aplicado exitosamente';
                } else {
                    document.getElementById('error-message').textContent = response.message;
                    document.getElementById('redeem-error').classList.remove('hidden');
                    document.getElementById('debug-content').textContent = `‚ùå Error: ${response.message}`;
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('debug-content').textContent = `‚ùå Error: ${error.message}`;
                alert('Error de conexi√≥n: ' + error.message);
            } finally {
                hideLoading('redeem-btn');
            }
        }

        // FUNCIONES CON SHEETDB - CORREGIDAS
        async function registerCustomer(name, phone, teamMember, code) {
    const expiryDate = new Date();
    expiryDate.setDate(expiryDate.getDate() + 30);
    
    const data = {
        authorized_by: teamMember,           // Miembro del equipo
        customer_name: name,                 // Nombre del cliente
        phone_number: phone,                 // Tel√©fono del cliente
        discount_percentage: 15,             // Porcentaje de descuento
        created_at: new Date().toISOString(), // Fecha de creaci√≥n
        redemption_code: code,               // C√≥digo generado
        redeemed: "FALSE",                   // No utilizado a√∫n
        redeemed_at: "",                     // Vac√≠o hasta que se redima
        expiration_date: expiryDate.toISOString().split('T')[0] // Fecha vencimiento
    };
    
    console.log('Enviando a SheetDB:', data);
    
    const response = await fetch(SHEETDB_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ data: data })
    });
    
    if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`HTTP error! status: ${response.status}, response: ${errorText}`);
    }
    
    return await response.json();
}

      async function redeemDiscount(name, phone, code) {
    try {
        // Validar que se ingrese al menos tel√©fono O c√≥digo
        if (!phone && !code) {
            return { success: false, message: 'Ingrese tel√©fono o c√≥digo' };
        }

        let searchUrl;
        
        // BUSCAR POR TEL√âFONO + C√ìDIGO (si ambos est√°n presentes)
        if (phone && code) {
            searchUrl = `${SHEETDB_URL}/search?phone_number=${phone}&redemption_code=${code}`;
        }
        // BUSCAR SOLO POR C√ìDIGO (si solo hay c√≥digo)
        else if (code) {
            searchUrl = `${SHEETDB_URL}/search?redemption_code=${code}`;
        }
        // BUSCAR SOLO POR TEL√âFONO (si solo hay tel√©fono)
        else if (phone) {
            searchUrl = `${SHEETDB_URL}/search?phone_number=${phone}`;
        }

        const response = await fetch(searchUrl);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.length === 0) {
            return { success: false, message: 'No se encontr√≥ el cliente' };
        }

        // Si hay m√∫ltiples resultados, tomar el primero
        const customer = data[0];
        
        // Verificar si ya fue utilizado
        if (customer.redeemed === "TRUE") {
            return { success: false, message: 'Este c√≥digo ya ha sido utilizado' };
        }
        
        // ACTUALIZAR
        const updateData = {
            redeemed: "TRUE",
            redeemed_at: new Date().toISOString()
        };
        
        const updateUrl = `${SHEETDB_URL}/redemption_code/${customer.redemption_code}`;
        const updateResponse = await fetch(updateUrl, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ data: updateData })
        });
        
        if (!updateResponse.ok) {
            throw new Error(`Error al actualizar: ${updateResponse.status}`);
        }
        
        return { 
            success: true, 
            customerName: customer.customer_name, 
            code: customer.redemption_code 
        };
        
    } catch (error) {
        throw error;
    }
}

        function generateUniqueCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
    </script>
</body>
</html>
